@page "/"

@using BeatGeneratorAPI

@inject ReflectedObjectGraph<ClockGenerator> ObjectGraph

<PageTitle>Valued Time</PageTitle>

@if (ObjectGraph.RootInteractNode is not null)
{
    <InteractNodeWrapper Node="ObjectGraph.RootInteractNode" />
    @*<DebugTree RootNode="ObjectGraph.RootInteractNode" />*@
}


@code {
    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            ObjectGraph.RootInstance.BeatUpdated += (sender, args) =>
            {
                ObjectGraph.Reload();
            };

            ObjectGraph.AppUpdated += (sender, args) =>
            {
                InvokeAsync(() =>
                {
                    StateHasChanged();
                    //Console.WriteLine("Re-rendered");
                });
            };
            //await AppHost.RootInstance.LoadAsync();
            ObjectGraph.Reload();
            await Task.CompletedTask;
        }
    }
}

